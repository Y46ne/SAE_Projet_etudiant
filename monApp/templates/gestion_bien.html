{% extends "base.html" %}

{% block title %}Mes Biens{% endblock %}

{% block head %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/logement_piece_bien.css') }}">
{% endblock %}

{% block content %}

<div class="p-8">
        <a href="{{ url_for('view_logement_pieces', id=piece.id_logement) }}" class="btn btn-danger">
            ← Retour aux pièces
        </a>

        <h1 class="text-2xl font-bold text-gray-800 mb-2">
            {{ piece.logement.nom_logement }} - {{ piece.nom_piece }}
        </h1>

        <p class="text-gray-600 mb-6">Gérez les biens immobiliers de cette pièce</p>

        {% if current_user.is_assureur %}
             <a href="{{ url_for('ajouter_bien', piece_id=piece.id_piece) }}" class="btn btn-success mb-3">Ajouter un bien</a>
        {% elif current_user.is_authenticated %}
             <a href="{{ url_for('ajouter_bien', piece_id=piece.id_piece) }}" class="btn btn-success mb-3">Ajouter un bien</a>
        {% endif %}

        <div class="main-content">
            <div class="search-filter">
                <input type="text" placeholder="Rechercher un bien..." id="searchInput">
            </div>
        
            <table id="piecesTable" class="table table-striped table-bordered table-hover">
                <thead>
                    <tr>
                        <th>Nom du bien</th>
                        <th>Catégorie</th>
                        <th>Date d’achat</th>
                        <th>Prix d'achat (€)</th>
                        <th>Valeur actuelle (€)</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody>
                    {% for bien in biens %}
                    <tr>
                        <td>{{ bien.nom_bien }}</td>
                        <td>{{ bien.categorie }}</td>
                        <td>{{ bien.date_achat.strftime('%d/%m/%Y') }}</td>
                        <td>{{ bien.prix_achat }}</td>
                        <td>{{ '%.2f' % (bien.valeur_actuelle or bien.calculer_valeur_actuelle() or 0) }}</td>
                        <td>
                        <div class="task-controls">
                            <a href="{{ url_for('detail_bien', id=bien.id_bien) }}" class="btn btn-info" title="Voir détails">
                                Voir
                            </a>
                            <a href="{{ url_for('modifier_bien', bien_id=bien.id_bien) }}" class="btn btn-warning" title="Modifier">
                                Modifier
                            </a>
                            
                            <form action="{{ url_for('supprimer_bien', bien_id=bien.id_bien) }}" method="post" style="display:inline;">
                                <button type="submit" class="btn btn-danger" onclick="return confirm('Êtes-vous sûr de vouloir supprimer ce bien ?');">
                                    Supprimer
                                </button>
                            </form>
                        </div>
                        </td>
                    </tr>
                    {% else %}
                    <tr>
                        <td colspan="6" class="text-center text-gray-500 py-4">
                            Aucun bien trouvé pour ce logement.
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>

<script src="{{ url_for('static', filename='js/searchTable.js') }}"></script>
<script>
    document.addEventListener('DOMContentLoaded', function() {
        setupTableSearch('searchInput', 'piecesTable');
    });
</script>

{% endblock %}