{% extends "base.html" %}

{% block title %}Mes Biens{% endblock %}

{% block head %}
  <link rel="stylesheet" href="{{ url_for('static', filename='css/gestion_bien.css') }}">
{% endblock %}


{% block content %}
<h1>RÃ©sidence principale - Salon</h1>
<p>GÃ©rez les biens immobiliers de ce logement</p>

{% with messages = get_flashed_messages(with_categories=true) %}
  {% if messages %}
    {% for category, message in messages %}
      <div class="alert alert-{{ category }}">{{ message }}</div>
    {% endfor %}
  {% endif %}
{% endwith %}

<div class="main-content">
    <div class="search-filter">
        <input type="text" placeholder="Rechercher un bien..." id="searchInput">
        <button id="filterBtn">Filtres</button>
    </div>

    <table id="biensTable">
        <thead>
            <tr>
                <th>Nom du bien</th>
                <th>CatÃ©gorie</th>
                <th>Date dâ€™achat</th>
                <th>Valeur (â‚¬)</th>
                <th>Ã‰tat</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody>
            {% for bien in biens %}
            <tr>
                <td>{{ bien.nom }}</td>
                <td>{{ bien.categorie }}</td>
                <td>{{ bien.date_achat.strftime('%d/%m/%Y') }}</td>
                <td>{{ bien.valeur }}</td>
                <td>
                    {% if bien.etat == 'Bon' %}
                        <span class="status bon">Bon</span>
                    {% elif bien.etat == 'Acceptable' %}
                        <span class="status acceptable">Acceptable</span>
                    {% else %}
                        <span class="status use">UsÃ©</span>
                    {% endif %}
                </td>
                <td>
                    <a href="{{ url_for('voir_bien', bien_id=bien.id) }}" class="view" title="Voir">ğŸ‘ï¸</a>
                    <a href="{{ url_for('modifier_bien', bien_id=bien.id) }}" class="edit" title="Modifier">âœï¸</a>
                    <form action="{{ url_for('supprimer_bien', bien_id=bien.id) }}" method="POST" style="display:inline;">
                        <button type="submit" class="delete" title="Supprimer" onclick="return confirm('Supprimer ce bien ?')">ğŸ—‘ï¸</button>
                    </form>
                </td>
            </tr>
            {% else %}
            <tr>
                <td colspan="6" style="text-align:center;">Aucun bien trouvÃ© pour ce logement.</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>

<script>
// Recherche dynamique (client-side)
document.getElementById('searchInput').addEventListener('keyup', function() {
    let filter = this.value.toLowerCase();
    let rows = document.querySelectorAll('#biensTable tbody tr');
    rows.forEach(row => {
        let text = row.textContent.toLowerCase();
        row.style.display = text.includes(filter) ? '' : 'none';
    });
});
</script>
{% endblock %}
